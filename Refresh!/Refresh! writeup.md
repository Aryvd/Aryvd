In this challenge, the goal is to find the hidden message in an image. A zip containing a folder with 1000 greyscale images and a script named prng.py is given. The challenge description and the hint allude to a well-known Steg algorithm called F5. F5 does a lot of complicated math to hide the data, but most importantly, it operates on the dct coefficients of a jpeg image and due to the way it is implemented, increases the number of zeroes in the whole image dct matrix (this is called shrinkage, hence the hint *shrink*). We use this property to find the image containing the hidden data among the 1000 images. It turns out the 5613721136707.jpg is the file with a different higher number of zeroes than the rest. 

![image](https://github.com/Aryvd/Aryvd/assets/72273892/390af731-7101-4aaf-b2f3-27b6595b31d8)


Now, f5 doesn’t hide the data in all the 8x8 dct matrices of a jpeg; instead, it uses a pseudo-random number generator to determine a random walk of matrices to hide the image. Given that we have a script called prng that needs a seed value and the file name is a big integer number, it's clear that the seed is the file name. Putting the seed value in the script, we get a few values(the number of values depends on the arbitrary flag length you use, but you can use any number. If it's less than 32, you’ll get a part of the flag, which you can use to guess the length of the flag, or if you put something like 100, which I used, you’ll get the flag plus some random bytes. )
![image](https://github.com/Aryvd/Aryvd/assets/72273892/4bb926bb-f11e-457f-931d-b0279ac38b43)



If we recall, the prng is used to decide the random walk of 8x8 matrices. Hence, we can conclude that the values are actually the coordinates of the 8x8 matrices within the image where the data is hidden. But then, how do you get the data from these matrices? Well, the description had a few suspicious words like trace and Diagon alley. A trace is the sum of all diagonal elements in a matrix, but the description said not to add, and diagon alley sounds like diagonally. So, let’s try to find the data only from the diagonal elements of the matrix. F5 hides the data by adding or subtracting one when necessary, making it so the bits are hidden as the lsb of the coefficients it operates on. Doing that for each matrix's diagonal elements and for all the matrices along the random walk generated by the prng, we finally get this binary string, which, when converted to ASCII, gives us the flag.
![image](https://github.com/Aryvd/Aryvd/assets/72273892/0f220318-70bf-42dd-980d-98d999b853af)

![image](https://github.com/Aryvd/Aryvd/assets/72273892/0812f5d0-3aa4-4871-af70-d5eb4f26b8fd)

Flag: BITSCTF{u53_f5_70_p4y_r3sp3ct5s}
