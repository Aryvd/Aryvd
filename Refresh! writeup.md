In this challenge the goal is to find the hidden message in an image. A zip containing a folder with a 1000 greyscale images and a script named prng.py is given. The challenge description and the hint allude to a well known Steg algorithm called F5. F5 does a lot of complicated math to hide the data , but most importantly , it operates on the dct coefficients of a jpeg image and due to the way its implemented , increases the number of zeroes in the whole image dct matrix (this is called shrinkage , hence the hint *shrink*) . We use this property to find the image containing the hidden data among the 1000 images. It turns out the 5613721136707.jpg is the file with a different higher number of zeroes than the rest. 

![[Pasted image 20240219142343.png]]

Now, f5 doesn’t hide the data in all the 8x8 dct matrices of a jpeg , instead it uses a pseudo random number generator to determine a random walk of matrices to hide the image. Given that we have a script called prng that needs a seed value and the file name is a big integer number , its clear that the seed is the file name. Putting the seed value in the script, we get a few values(the number of values depend on the arbitrary flag length you use, but you can use any number , if its less than 32 you’ll get a part of the flag which you can use to guess the length of the flag or if you put something like 100 , which i used you’ll get the flag plus some random bytes. )
![[Pasted image 20240219142938.png]]


If we recall , the prng is used to decide random walk of 8x8 matrices . Hence we can conclude that the the values are actually the coordinates of the 8x8 matrices within the image where the data is hidden. But then how do you get the data from these matrices? Well the description had a few suspicious words like trace and diagon alley. A trace is the sum of all diagonal elements in a matrix , but the description said not add , and diagon alley sounds like diagonally . So let’s try and find the data only from the diagonal elements of the matrix . F5 hides the data by adding or subtracting one when necessary , which basically makes it so the bits are hidden as the lsb of the coefficients its operating on. Doing that for the diagonal elements of the matrix , and doing it for all the matrices along the random walk generated by the prng , we finally get this binary string which when converted to ascii gives us the flag.
![[Pasted image 20240219143439.png]]

![[Pasted image 20240219143512.png]]